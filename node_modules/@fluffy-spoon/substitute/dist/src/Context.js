"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var InitialState_1 = require("./states/InitialState");
var Substitute_1 = require("./Substitute");
var Context = /** @class */ (function () {
    function Context() {
        var _this_1 = this;
        this._initialState = new InitialState_1.InitialState();
        this._state = this._initialState;
        this._proxy = new Proxy(function () { }, {
            apply: function (_target, _this, args) { return _this_1.apply(_target, _this, args); },
            set: function (_target, property, value) { return (_this_1.set(_target, property, value), true); },
            get: function (_target, property) { return _this_1.get(_target, property); }
        });
        this._rootProxy = new Proxy(function () { }, {
            apply: function (_target, _this, args) { return _this_1.initialState.apply(_this_1, args); },
            set: function (_target, property, value) { return (_this_1.initialState.set(_this_1, property, value), true); },
            get: function (_target, property) { return _this_1.initialState.get(_this_1, property); }
        });
        this._receivedProxy = new Proxy(function () { }, {
            apply: function (_target, _this, args) { return _this_1._receivedState.apply(_this_1, args); },
            set: function (_target, property, value) { return (_this_1.set(_target, property, value), true); },
            get: function (_target, property) {
                var state = _this_1.initialState.getPropertyStates.find(function (getPropertyState) { return getPropertyState.property === property; });
                if (state === void 0)
                    throw new Error("there are no mock for property: " + String(property));
                _this_1._receivedState = state;
                return _this_1.receivedProxy;
            }
        });
    }
    Context.prototype.apply = function (_target, _this, args) {
        return this._state.apply(this, args);
    };
    Context.prototype.set = function (_target, property, value) {
        return this._state.set(this, property, value);
    };
    Context.prototype.get = function (_target, property) {
        if (property === Substitute_1.HandlerKey) {
            return this;
        }
        return this._state.get(this, property);
    };
    Object.defineProperty(Context.prototype, "proxy", {
        get: function () {
            return this._proxy;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Context.prototype, "rootProxy", {
        get: function () {
            return this._rootProxy;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Context.prototype, "receivedProxy", {
        get: function () {
            return this._receivedProxy;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Context.prototype, "initialState", {
        get: function () {
            return this._initialState;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Context.prototype, "state", {
        set: function (state) {
            if (this._state === state)
                return;
            this._state = state;
            if (state.onSwitchedTo)
                state.onSwitchedTo(this);
        },
        enumerable: true,
        configurable: true
    });
    return Context;
}());
exports.Context = Context;
//# sourceMappingURL=Context.js.map